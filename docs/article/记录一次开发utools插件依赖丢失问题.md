## è®°å½•ä¸€æ¬¡å¼€å‘utoolsæ’ä»¶ä¾èµ–ä¸¢å¤±é—®é¢˜


äº‹æƒ…æ˜¯è¿™æ ·å­çš„ï¼Œæˆ‘æ‰“å¼€æˆ‘çš„æ’ä»¶è¯„è®ºé¡µé¢æ—¶ï¼Œçªç„¶çœ‹åˆ°ä¸€æ¡è¯„è®º

![20231101150024](https://raw.githubusercontent.com/QC2168/note-img/main/20231101150024.png)

> æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥æ˜¯å½“å±å¹•æ•è·å®Œæˆä¹‹åï¼Œä¼šå¼¹å‡ºä¸€ä¸ªç¼–è¾‘çª—å£å¹¶ä¸”åŠ è½½ç”¨æˆ·çš„å±å¹•æˆªå–åŒºåŸŸ
>
> ä½†ç°åœ¨æ˜¯çª—å£å¼¹å‡ºæ¥äº†ï¼Œå›¾ç‰‡æ•°æ®å¹¶æ²¡æœ‰åŠ è½½æˆåŠŸ

äºæ˜¯ï¼Œæˆ‘åœ¨æˆ‘è‡ªå·±ç”µè„‘ä¸Šå°è¯•å¤ç°è¿™ä¸ªé—®é¢˜

å‘ç°è¿™ä¸ªé—®é¢˜ï¼Œåªå­˜åœ¨äºç”Ÿäº§ç¯å¢ƒï¼Œå¼€å‘ç¯å¢ƒä¸‹è½½æ˜¯æ²¡æœ‰é—®é¢˜çš„

ä½†æ˜¯é—®é¢˜åˆæ¥äº†ï¼Œæˆ‘åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹æˆ‘åº”è¯¥å¦‚ä½•å»è¿›è¡Œ`debug`ï¼Œå¯»æ‰¾é—®é¢˜çš„æºå¤´ï¼Ÿ

å› ä¸ºåœ¨`utools`æ’ä»¶ä¸­ï¼Œæˆ‘ä¸èƒ½åƒå¹³æ—¶ä¸€æ ·å‘¼å”¤å‡º`devTools`å·¥å…·é¢æ¿ï¼Œä¹Ÿä¸èƒ½åœ¨`terminal`ä¸­æŸ¥çœ‹ç›¸å…³çš„è¾“å‡ºæ—¥å¿—


## å®šä½é—®é¢˜

### ç¿»é˜…Commit

ç”±äºåœ¨çº¿ä¸Šæ— æ³•ä½¿ç”¨`devTools`ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªç¬¨åŠæ³•æ¥æ’æŸ¥è¿™ä¸ª`Bug`

æˆ‘åœ¨æˆ‘å‘å¸ƒçš„è¿™ä¸ªç‰ˆæœ¬çš„`commit`ä¹‹å‰ä¸€æ¡ä¸€æ¡è¿›è¡Œæ‰“åŒ…æµ‹è¯•

ç»è¿‡æ¡æ¡æµ‹è¯•ï¼Œç»ˆäºåœ¨æŸä¸€æ¡`commit`ä¸­ï¼Œå‘ç°äº†è¿™ä¸ªé—®é¢˜

æˆ‘å¤§æµ·æé’ˆçš„å¼€å§‹ç¿»é˜…è¿™äº›å˜åŠ¨çš„æ–‡ä»¶...

### Debug App

æˆ‘å¼€å§‹å‘ç¤¾åŒºå¯»æ±‚å¸®åŠ©

### eruda

> `eruda`æ˜¯ä¸€ä¸ªç”¨äºåœ¨ç§»åŠ¨ç½‘é¡µä¸Šè¿›è¡Œå‰ç«¯å¼€å‘å’Œè°ƒè¯•çš„è½»é‡çº§å·¥å…·ï¼Œæä¾›æ§åˆ¶å°ã€ç½‘ç»œè¯·æ±‚ç›‘æ§ã€å…ƒç´ æŸ¥çœ‹ã€æ€§èƒ½åˆ†æç­‰åŠŸèƒ½

å°è¯•äº†ä½¿ç”¨`eruda`å·¥å…·è¿›è¡Œæ’æŸ¥

ä½ çŒœæ€ä¹ˆç€ï¼Œé‡åˆ°äº†ç±»ä¼¼çš„é—®é¢˜

å½“æˆ‘åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œ`eruda`æ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ï¼Œä½†æ˜¯åˆ°äº†ç”Ÿäº§ç¯å¢ƒæ— æ³•æ­£å¸¸æ˜¾ç¤ºå‡º`eruda`çš„æ§åˆ¶æŒ‰é’®

![20231102162741](https://raw.githubusercontent.com/QC2168/note-img/main/20231102162741.png)

![20231102162448](https://raw.githubusercontent.com/QC2168/note-img/main/20231102162448.png)

### debugtron

> `debugtron`æ˜¯ä¸€ä¸ªç”¨äºè°ƒè¯•ç”Ÿäº§ç¯å¢ƒçš„electronåº”ç”¨å·¥å…·

çªç„¶ï¼Œç¤¾ç¾¤é‡Œçš„å‡ºç°äº†ä¸€ä½å¤§ä½¬ï¼Œè®©æˆ‘ä½¿ç”¨`debugtron`è¿›è¡Œè°ƒè¯•çœ‹çœ‹æ˜¯å‡ºç°äº†ä»€ä¹ˆé—®é¢˜

äºæ˜¯ï¼Œä¸‹è½½äº†æœ€æ–°ç‰ˆæœ¬çš„`debugtron`ï¼Œè¿›è¡Œè°ƒè¯•

ä¸å‡ºæ„å¤–çš„è¯ï¼Œå°±å‡ºæ„å¤–äº†~

æˆ‘ä½¿ç”¨debugtronè¿›è¡Œè°ƒè¯•utoolsçš„æ—¶å€™ï¼Œå‡ºç°äº†é—ªé€€çš„æƒ…å†µ

![debug-utools-failed](https://raw.githubusercontent.com/QC2168/note-img/main/debug-utools-failed.gif)

ç»è¿‡å’Œå¤§ä½¬ä¸€ç•ªäº¤æµï¼Œå¾—çŸ¥`debugtron`è°ƒè¯•ï¼Œæ˜¯åœ¨å¯åŠ¨åº”ç”¨çš„æ—¶å€™æ·»åŠ ä¸Šå‘½ä»¤è¡Œå‚æ•°è§¦å‘`debug`åŠŸèƒ½çš„ï¼Œè€Œ`utools`å†…éƒ¨å¯èƒ½é˜»æ­¢çš„è¿›ç¨‹è°ƒè¯•æ–¹é¢çš„åŠŸèƒ½å¯¼è‡´æˆ‘ä»¬æ— æ³•ä½¿ç”¨`debugtron`è¿›è¡Œè°ƒè¯•

![20231102135933](https://raw.githubusercontent.com/QC2168/note-img/main/20231102135933.png)

æ„Ÿè°¢å¤§ä½¬ï¼Œè¿˜å¸®æˆ‘`patch`äº†ä¸€ä¸ªè°ƒè¯•`utools`çš„ç‰ˆæœ¬

![20231102152925](https://raw.githubusercontent.com/QC2168/note-img/main/20231102152925.png)

æˆ‘åˆè¿›è¡Œäº†è·‘ä¸€éæ’ä»¶ï¼Œè¿™æ¬¡ç»ˆäºæ‰¾åˆ°é—®é¢˜çš„æºå¤´äº†

![20231102160833](https://raw.githubusercontent.com/QC2168/note-img/main/20231102160833.png)

åŸæ¥é—®é¢˜å‡ºåœ¨é¡¹ç›®é‡Œçš„`preload.js`ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹çš„ä¾èµ–åº“(`fs-extra`)ï¼Œåœ¨æ‰“åŒ…æˆæ’ä»¶çš„æ—¶å€™æ²¡æœ‰å°†å®ƒæ‰“åŒ…è¿›å»æ‰€å¯¼è‡´çš„

è€Œå¼€å‘ç¯å¢ƒä¸­ï¼Œä»£ç æ˜¯åœ¨é¡¹ç›®`/dist`æ–‡ä»¶å¤¹é‡Œï¼Œæ˜¯å¯ä»¥ç›´æ¥è®¿é—®åˆ°`node_modules`æ–‡ä»¶å¤¹é‡Œçš„ä¾èµ–åŒ…çš„ï¼Œæ‰€ä»¥åœ¨è·‘çš„æ—¶å€™æ²¡æœ‰å‡ºç°é—®é¢˜

### å…³äºPatchç‰ˆæœ¬

åé¢å’Œå¤§ä½¬äº¤æµåï¼ŒåŸæ¥æ˜¯å¯åŠ¨`electron`åº”ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥æ·»åŠ ä¸Šç›¸åº”çš„`debug`å‚æ•°ï¼Œä½¿åº”ç”¨å‘¼å‡º`devTools`é¢æ¿ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¹Ÿèƒ½è°ƒè¯•åº”ç”¨

è€Œè¿™ä¸ªç‰ˆæœ¬æ”¹åŠ¨äº†å¯ç”¨åº”ç”¨çš„ä»£ç ï¼Œå°†`inspect`å‚æ•°å–æ¶ˆ

> ä¸è¿‡è¿™ä¼šå¯¼è‡´æˆ‘ä»¬æ— æ³•å¯¹ä¸»çº¿ç¨‹è¿›è¡Œè°ƒè¯•ï¼Œä½†æ˜¯é—®é¢˜ä¹Ÿä¸å¤§ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯è¦è°ƒè¯•æ’ä»¶ï¼ˆå­çª—å£çš„æ•°æ®ï¼‰æ¸²æŸ“è¿›ç¨‹

![20231102133301](https://raw.githubusercontent.com/QC2168/note-img/main/20231102133301.png)

è¿™æ˜¯`debugtron`é¡¹ç›®ä¸­çš„æºç ï¼Œä»£ç ä½ç½®åœ¨[main/src/main/actions.ts](https://github.com/pd4d10/debugtron/blob/main/src/main/actions.ts#L53)

### è§£å†³é—®é¢˜

ç°åœ¨å·²ç»å¾—çŸ¥æ˜¯`preload.js`ä¸­æ²¡æœ‰ä¾èµ–åŒ…æ‰€å¯¼è‡´çš„é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ„å»ºå·¥å…·å°†`preload.js`ä¸­æ‰€éœ€çš„ä¾èµ–æ‰“åŒ…è¿›`preload.js`å³å¯

è¿™é‡Œæˆ‘é€‰ä¸­äº†`rollup`ä½œä¸ºæ‰“åŒ…å·¥å…·ï¼Œå®‰è£…å®ƒå’Œä¸€äº›ç›¸å…³æ’ä»¶

> ä¹Ÿå¯ä»¥ç›´æ¥å°†ç¬¬ä¸‰æ–¹åº“çš„`min.js`ç§»åŠ¨åˆ°é¡¹ç›®é‡Œï¼Œä½†æ˜¯è¿™æ ·å­åšçš„è¯ï¼Œåç»­å¢åŠ ä¾èµ–ä¼šæ¯”è¾ƒéº»çƒ¦äº›

```bash
pnpm install rollup @rollup/plugin-commonjs @rollup/plugin-node-resolve
```

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œæ–°å»º`rollup.config.mjs`æ–‡ä»¶ï¼Œä½œä¸º`rollup`çš„é…ç½®æ–‡ä»¶

```JavaScript
import { nodeResolve } from '@rollup/plugin-node-resolve';
import commonjs from '@rollup/plugin-commonjs';
export default {
  input: './electron/preload.js',
  output: {
    file: './dist/electron/preload.js',
    format: 'cjs'
  },
  plugins: [nodeResolve(),commonjs() ],
  external:['electron']
};
```

è¿™æ®µä»£ç çš„åŠŸèƒ½æ˜¯å°†é¡¹ç›®ä¸­çš„`electron/preload.js`æ–‡ä»¶è¿›è¡Œä¸€ä¸ªæ‰“åŒ…æ“ä½œï¼Œåœ¨æ‰“åŒ…çš„æ—¶å€™å°†æˆ‘ä»¬æ‰€å¼•ç”¨çš„ä¾èµ–åº“ä¹ŸåŒæ—¶æ‰“åŒ…è¿›å»

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸è¦æŠŠ`electron`ä¹Ÿæ‰“åŒ…è¿›å»ï¼Œå› ä¸ºå®ƒåˆ°æ—¶è¦ä½¿ç”¨åˆ°çš„æ˜¯`utools`ä¸­çš„`electron`ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨`external`å­—æ®µå°†å®ƒæ’é™¤

ä¿®æ”¹åï¼Œå½“æˆ‘ä»¬è¦æ„å»ºæ’ä»¶çš„æ—¶å€™ï¼Œéœ€è¦å¤šè·‘ä¸€ä¸‹`rollup`æŒ‡ä»¤è¿›è¡Œå¤„ç†

ç»è¿‡æ‰“åŒ…åçš„`preload.js`ï¼Œä¾èµ–ä¸¢å¤±çš„é—®é¢˜ä¹Ÿå°±è§£å†³äº†ğŸ˜Š
