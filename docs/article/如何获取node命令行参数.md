---
title: å¦‚ä½•è·å–nodeå‘½ä»¤è¡Œä¸­å‚æ•°
tags: [JavaScript]
---

## å¦‚ä½•è·å–nodeå‘½ä»¤è¡Œä¸­å‚æ•°

åœ¨å¼€å‘`cli`å·¥å…·æ—¶ï¼Œå¾€å¾€ç¦»ä¸å¼€è·å–æŒ‡ä»¤ä¸­å„ç§å‚æ•°ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥æœ¬æ–‡å°†å¸¦ç€ä½ å¦‚ä½•åœ¨`Node.js`ä¸­è·å–æ‰§è¡Œæ—¶çš„å‚æ•°

## è®¤è¯†process
`process`æ˜¯`nodejs`å†…ç½®çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æä¾›äº†å½“å‰æœ‰å…³`nodejs`è¿›ç¨‹çš„ä¿¡æ¯ã€‚ï¼ˆä¾‹å¦‚è·å–å½“å‰è¿›ç¨‹idï¼Œæ‰§è¡Œå¹³å°ç­‰ä¸å½“å‰æ‰§è¡Œè¿›ç¨‹ç›¸å…³çš„å¯¹è±¡å’Œæ–¹æ³•ï¼‰
> [node processæ–‡æ¡£](https://nodejs.org/api/process.html#process)

## process.arg
åœ¨è¯¥å¯¹è±¡ä¸­ï¼Œæœ‰ä¸€ä¸ª`argv`å±æ€§ï¼Œå®ƒå¯ä»¥è·å–å½“å‰`node`æ‰§è¡Œæ—¶ä¼ å…¥å„ä¸ªå‚æ•°æ•°æ®ã€‚

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`index.js`æ–‡ä»¶ï¼Œå…ˆæ‰“å°ä¸‹`process.argv`é‡Œé¢æ˜¯ä»€ä¹ˆä¸œè¥¿
```JavaScript
console.log(process.argv)
// node index.js
[
  'D:\\software\\nodejs\\node.exe',
  'D:\\project\\script\\src\\index.js'
]
```
ä»ä¸Šé¢çš„è¾“å‡ºç»“æœï¼Œå¯ä»¥å¾—åˆ°å½“å‰æ‰§è¡Œçš„`node`ç¨‹åºè·¯å¾„(ä¹Ÿå°±æ˜¯`process.execPath`è¿”å›å€¼)å’Œæ‰§è¡Œçš„æ–‡ä»¶ï¼ˆ`index.js`ï¼‰è·¯å¾„ï¼Œæˆ‘ä»¬åƒä½¿ç”¨å…¶ä»–`cli`å·¥å…·ä¸€æ ·æ·»åŠ ä¸€äº›å‚æ•°è¯•è¯•
```bash
node index.js name=zhangsan age=18
```
```JavaScript
[
  'D:\\software\\nodejs\\node.exe',
  'D:\\project\\script\\src\\index.js',
  'name=zhangsan',
  'age=18'
]
```
å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¼ å…¥çš„`name`å‚æ•°ä¸`age`å‚æ•°ä¹Ÿè¢«è·å–åˆ°äº†
> éœ€è¦æ³¨æ„çš„æ˜¯argvä¸­çš„å‚æ•°æ˜¯é€šè¿‡ç©ºæ ¼æ¥åˆ†å‰²çš„

é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šåœ¨å‘½ä»¤è¡Œæ¯ä¸ªå‚æ•°å‰é¢æ·»åŠ `--`å­—ç¬¦ï¼Œç”¨æ¥è¯†åˆ«ä¼ å…¥çš„å„ä¸ªå‚æ•°ã€‚ï¼ˆè¿™ç§æ˜¯`GNU`é£æ ¼çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œä»¥`--`å¼€å¤´ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼‰

ä¾‹å¦‚åœ¨`esbuild`æ„å»ºå·¥å…·ä¸­
```bash
esbuild app.jsx --bundle --outfile=out.js
```
ä¾‹å¦‚åœ¨`vite`æ„å»ºå·¥å…·ä¸­
```bash
vite --config my-config.js
```

é™¤äº†ä¸Šé¢çš„`GNU`é£æ ¼ï¼Œå¸¸è§çš„è¿˜æœ‰`UNIX`é£æ ¼ï¼Œä»¥`-`å¼€å¤´çš„ï¼Œä¾‹å¦‚ä¸‹é¢å‘½ä»¤è·å–å½“å‰ç›®å½•ä¸‹æ–‡ä»¶ï¼Œæ–‡ä»¶å¤¹è¯¦æƒ…ã€‚
```bash
ls -l
```
ä½ æ˜¯ä¸æ˜¯ä¼šæƒ³åˆ°äº†æœ€å¸¸ç”¨çš„`npm`äº†ï¼Ÿ
æ²¡é”™ï¼Œå®ƒå³æ˜¯ä½¿ç”¨`UNIX`é£æ ¼
```
npm i -d esbuild
```

ç»§ç»­æˆ‘ä»¬æ­¥éª¤ï¼Œä¿®æ”¹ä¸€ä¸‹ä¸Šé¢çš„å‘½ä»¤ä¸º
```bash
node index.js --name=zhangsan --age=18
```
å°†ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºç»“æœ
```JavaScript
[
  'D:\\software\\nodejs\\node.exe',
  'D:\\project\\script\\src\\index.js',
  '--name=zhangsan',
  '--age=18'
]
```
## å°è£…è·å–å‚æ•°å‡½æ•°
ä»ä¸Šé¢ä¸¤ä¸ªä¾‹å­å’Œå®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥argvçš„å‰ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å›ºå®šçš„ï¼Œåœ¨è·å–ç”¨æˆ·ä¼ å…¥çš„å‚æ•°æˆ‘ä»¬éœ€è¦`process.argv.slice(2)`ä¸€ä¸‹,åªè·å–ä»ä¸‹æ ‡2å¼€å§‹çš„å…ƒç´ ã€‚
ä¹Ÿå³æ˜¯
```bash
[
  '--name=zhangsan',
  '--age=18'
]
```
æœ‰äº†è¿™äº›æ•°æ®ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å†è¿›ä¸€æ­¥è§£æ„é‡Œé¢çš„å‚æ•°ï¼Œå°†å‰é¢çš„`--`å»é™¤æ‰ï¼ŒæŠŠ`key=value`æ”¹å˜æˆ`{key:value}`æ–¹ä¾¿æˆ‘ä»¬åœ¨å¼€å‘ä¸­è¿›è¡Œå‚æ•°è·å–ã€‚
æœ€ç»ˆæˆ‘ä»¬å¾—åˆ°äº†è¿™æ ·å­çš„å‡½æ•°ï¼š
- è·`process.argv`æ•°ç»„ï¼Œå¹¶åˆ‡ç‰‡ä»ä¸‹æ ‡2å¼€å§‹
- åˆ¤æ–­æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼æ˜¯å¦ä¸º`--`å¼€å¤´ï¼Œæ˜¯åˆ™è§†ä¸ºç”¨æˆ·ä¼ å…¥å‚æ•°
- åŒæ ·è¿›è¡Œåˆ‡ç‰‡æ“ä½œï¼Œè·å–ä¸‹æ ‡2å¼€å§‹çš„å­—ç¬¦ï¼Œå†é€šè¿‡`=`åŒºåˆ†å‡ºå¯¹åº”çš„`key`å’Œ`value`ï¼Œå…¶è¿”å›çš„æ˜¯`[key,value]`
- æœ€åï¼Œå°†è¿™ä¸ªäºŒç»´æ•°ç»„ä¼ å…¥åˆ°`Object.fromEntries`è½¬æ¢ä¸ºä¸€ä¸ªå¯¹è±¡
```typescript
const arguments = process.argv.slice(2);
const params = Object.fromEntries(
  arguments.reduce((pre, item) => {
    if (item.startsWith("--")) {
      return [...pre, item.slice(2).split("=")];
    }
    return pre;
  }, []),
);
console.log(params)
// { name: 'zhangsan', age: '18' }
```
å½“ç„¶ï¼Œä¸Šé¢è¿™ä¸ªåªæ˜¯ç®€å•çš„è·å–å‚æ•°çš„å‡½æ•°ï¼Œä¹Ÿæ²¡æœ‰ä¸€äº›è¾¹ç•Œæƒ…å†µï¼ˆä¾‹å¦‚å‡ºç°`foo=bar=baz`å‚æ•°ç­‰æƒ…å†µï¼‰ã€‚
### ç›¸å…³çš„è§£æåº“
åœ¨`github`ä¸Šä¹Ÿæœ‰ä¸€äº›æˆç†Ÿçš„å‘½ä»¤è¡Œå‚æ•°è§£æåº“ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦ä¹Ÿå¯ä»¥çœ‹çœ‹æºç ğŸ”ğŸ”

- [mri](https://github.com/lukeed/mri)
- [yargs-parser](https://github.com/yargs/yargs-parser)
- [minimist](https://github.com/minimistjs/minimist)

ğŸ˜Š å¦‚æœæ‚¨è§‰å¾—è¿™ä¸€ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œè¯·ç‚¹ä¸ªğŸ‘ ğŸŒ¹ğŸŒ¹