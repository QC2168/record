---
title: XSS攻击
tags: [Browser]
---


## XSS攻击

XXS即（Cross Site Scripting），跨站脚本，为什么不是叫CSS呢？原因是为了CSS（Cascading Style Sheets）做出区分。

是最普遍的Web应用安全漏洞

指的是在浏览器中执行恶意脚本，获取用户数据信息并执行对应的操作

XSS一般可以操作一下事件
- 窃取Cookie，因为它会在浏览器发送请求时自动发出
- 监听用户行为，通过植入脚本方式，获取用户行为发送到目标服务器（攻击者）
- 修改Dom，伪造登录表单，植入iframe
- 在页面中生成广告
- 在访问量较大的网站上的XSS可以攻击一些小型网站，实现DDos攻击

XSS也分为三种方式
## 存储型

存储型（又称**持久型**）指的是将数据储存起来，将一段恶意脚本代码存储到网站的数据库中，在后续客户端执行的时候就会直接执行这一段脚本代码，达到攻击效果

例如在评论区页面的提交输入框输入`<script>alter('我是攻击代码')</script>`，提交的时候如果前后端都没有做好处理，当下次浏览器渲染评论区内容时就会直接执行该代码。

像现在主流的Vue框架都会对代码做出转义工作，[详情请查阅](https://cn.vuejs.org/guide/best-practices/security.html#potential-dangers)

## 反射型

反射性指的是将恶意脚本作为网络请求的一部分

例如浏览器发出一个带有query参数的请求
```
http://192.168.0.29/api/get?num=<script>alert("我是攻击代码")</script>
```
服务器拿到这个参数时候，再返回给客户端，此时浏览器解析的时候就会执行对应的内容，达到攻击效果

因为通过了浏览器->服务器->浏览器->解析执行，所以被命名为反射型

## 文档型

文档型指的是通过“中间人”的方式进行攻击，在客户端与服务器端进行数据传输的时候通过劫持网络数据包，修改里面的内容。

## 如何防范XSS

### 转义

不要相信任何一方提供的输入，都要对其进行转义工作

例如`5 < 7`，转义为`5 &lt; 7`


### 防范存储型和反射型

存储型和反射型都是从服务器端取出恶意代码之后，将其插入到html被浏览器执行的。

常见的预防方法有
- 改成纯前端渲染，把代码和数据进行分开
  - 具体做法是
  - 浏览器先加载一个静态的html，与不包含业务的数据
  - 通过js网络请求数据，调用DomApi更新到页面上
- 对HTML进行转义操作
  - 常见的模板引擎都会对HTML内容进行转义（`& < > " ' /`）


### CSP（Content Security Policy，浏览器中的内容安全策略）

严格的 CSP 在 XSS 的防范中可以起到以下的作用：

- 禁止加载外域代码，防止复杂的攻击逻辑
- 禁止外域提交，网站被攻击后，用户的数据不会泄露到外域
- 禁止内联脚本执行（规则较严格，目前发现 GitHub 使用）
- 禁止未授权的脚本执行（新特性，Google Map 移动版在使用）
- 合理使用上报可以及时发现 XSS，利于尽快修复问题


### 限制用户输入长度

对于不受信任的输入，应该规定一个合理的长度，虽然无法完全方式XSS攻击，但可以增加 XSS 攻击的难度

### 设置Http-only

禁止js读取cookie，攻击者在植入脚本后无法窃取cookie数据
