<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        let objA = {
            foo: 'foo',
            bar: { bar: 'bar' },
            age: 18,
            name: '山田',
            home: undefined,
            arr: [undefined, null],
            set: new Set(['a', 'b', 'c']),
            fn: () => { },
            arrowFn: () => { },
            map: new Map([
                ['a', 'aa'],
                ['b', 'bb']
            ])
        }
        let deepObjA = deepClone(objA)
        objA.age = 20
        objA.bar.bar = null
        objA.arr = ['arr']
        objA.map.set('666', 666)
        console.log({ objA, deepObjA })
        console.log(typeof objA.fn)
        console.log(typeof deepObjA.fn)

        /** 深拷贝实现
         * 1. 基本功能实现，解决嵌套对象问题
         * 2. 对数组类型的处理
         * 3. 对函数类型的处理
         * 4. 对 Symbol类型的处理（分别作为键值时的处理）
         * 5. 对 Set 类型的处理
         * 6. 对 Map 类型的处理
         * 7. 解决循环引用问题
         */

        // 判断处理对象
        function isObject(value) {
            const valueType = typeof value
            return value !== null && (valueType === 'object' || valueType == 'function')
        }

        function deepClone(val, map = new WeakMap()) {

            // 处理Set类型
            if (val instanceof Set) {
                return new Set([...val])
            }

            // 处理Map类型
            if (val instanceof Map) {
                return new Map([...val])
            }

            // 处理symbol类型
            if (typeof val === 'symbol') {
                return Symbol(val.description)
            }

            // 处理函数
            if (typeof val === 'function') {
                return val
            }

            // 处理对象
            if (!isObject(val)) {
                return val
            }

            // 判断是否有环，当前对象是否在set列表中
            if (map.has(val)) {
                return map.get(val)
            }

            // 处理数组
            const result = Array.isArray(val) ? [] : {}

            // 保存处理的值，下次判断是否有环
            map.set(val, result)

            for (const key in val) {
                result[key] = deepClone(val[key], map)
            }

            // 处理对象中的symbol
            const sKeys = Object.getOwnPropertySymbols(val)
            for (const key of sKeys) {
                result[key] = deepClone(val[key], map)
            }

            return result
        }



    </script>
</body>

</html>